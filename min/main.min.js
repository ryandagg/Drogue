var GameSpace=function(){var t=function(t){return"#column-"+String(t[0])+"-row-"+String(t[1])},a=function(t){$("#messages").append("<p>"+t+"</p>")},e=function(t,a){return u.map[m.y+a][m.x+t].impassable?"impassable":u.map[m.y+a][m.x+t].monster?"monster":void 0},s=function(t){if(108===t){var s=1,o=0;"impassable"===e(s,o)?a("You shall not pass!"):"monster"===e(s,o)||u.updateRogue(s,o)}else if(104===t){var s=-1,o=0;"impassable"===e(s,o)?a("You shall not pass!"):u.updateRogue(s,o)}else if(106===t){var s=0,o=1;"impassable"===e(s,o)?a("You shall not pass!"):u.updateRogue(s,o)}else if(107===t){var s=0,o=-1;"impassable"===e(s,o)?a("You shall not pass!"):u.updateRogue(s,o)}else if(117===t){var s=1,o=-1;"impassable"===e(s,o)?a("You shall not pass!"):u.updateRogue(s,o)}else if(121===t){var s=-1,o=-1;"impassable"===e(s,o)?a("You shall not pass!"):u.updateRogue(s,o)}else if(110===t){var s=1,o=1;"impassable"===e(s,o)?a("You shall not pass!"):u.updateRogue(s,o)}else if(98===t){var s=-1,o=1;"impassable"===e(s,o)?a("You shall not pass!"):u.updateRogue(s,o)}},o=function(a,e){this.rows=e,this.columns=a,this.map=[],this.tileMatrixGenerator=function(){for(var t=0;t<this.rows;t++){for(var a=[],e=0;e<this.columns;e++)a.push(new n([e,t]));this.map.push(a)}},this.createMap=function(){this.tileMatrixGenerator()},this.createRoom=function(t){for(var a=t.xCenter-Math.floor(t.width/2),e=t.yCenter-Math.floor(t.height/2),s=0;s<t.height;s++)for(var o=0;o<t.width;o++)0===s||s===t.height-1?this.map[s+e][o+a]=new l(o+a,s+e):(0===o||o===t.width-1)&&(this.map[s+e][o+a]=new l(o+a,s+e));console.log(this.map[16][27])},this.createTerrain=function(){var t=4,a=8,e=new i(Math.floor(u.columns/2),Math.floor(u.rows/2),u.columns,u.rows);this.createRoom(e);var s=new i(Math.floor(u.columns/2),Math.floor(u.rows/2),Math.floor(Math.random()*(a-t)+t),Math.floor(Math.random()*a+t));this.createRoom(s)},this.createMonsters=function(t){for(var a=0;t>a;){var e=Math.floor(Math.random()*u.rows),s=Math.floor(Math.random()*u.columns),o=new p(s,e);"dot"===u.map[e][s].class&&(u.map[e][s]=o,a++)}},this.placeCharacter=function(){this.map[m.y][m.x]=m},this.updateDisplay=function(a,e){$(t(a.location())).text(a.text),$(t(e.location())).text(e.text),$(t(a.location())).removeClass(),$(t(e.location())).removeClass(),$(t(e.location())).addClass(e.class+" tile"),$(t(a.location())).addClass(a.class+" tile")},this.updateRogue=function(t,a){var e=new n(m.x,m.y);console.log(e.location()),m.x+=t,m.y+=a,this.map[m.y][m.x]=m,this.map[m.y-a][m.x-t]=e,console.log(m.location()),this.updateDisplay(m,e)},this.drawMap=function(){$("#game-window").empty();var t=$("#game-window-template").html(),a=Handlebars.compile(t),e=this,s=0;Handlebars.registerHelper("columnCounter",function(){return s%e.columns}),Handlebars.registerHelper("rowCounter",function(){return s++,Math.floor(s/e.columns)}),$("#game-window").append(a(e))}},i=function(t,a,e,s){this.xCenter=t,this.yCenter=a,this.width=e,this.height=s},n=function(t,a){this.x=t,this.y=a,this.text=".",this.class="dot",this.impassable=!1};n.prototype.location=function(){return[this.x,this.y]};var r=function(){};r.prototype=new n,r.prototype.constructor=r;var l=function(t,a){n.call(this,t,a),this.text="#",this.class="wall",this.impassable=!0};l.prototype=new r,l.prototype.constructor=l;var h=function(t,a){n.call(this,t,a),this.text="@",this.class="character",this.health=100,this.attack=100,this.defense=100,this.damage=100};h.prototype=new n,h.prototype.constructor=h;var c=function(){this.healthBase=100,this.attackBase=100,this.damageBase=100,this.defenseBase=100,this.monster=!0};c.prototype.attack=function(){},c.prototype=new n,c.prototype.constructor=c;var p=function(t,a){n.call(this,t,a),this.class="rat",this.text="r",this.health=this.healthBase/10,this.attack=this.attackBase/10,this.defense=this.defenseBase/10,this.damage=this.damageBase/10,this.treasureQuality=1};p.prototype=new c,p.prototype.constructor=p;var u=new o(60,40),m=new h(Math.floor(u.columns/2),Math.floor(u.rows/2)),f=function(){u.createMap(),u.createTerrain(),u.placeCharacter(),u.createMonsters(10),u.drawMap()};return{initialize:f,rogue:m,currentLevel:u,keyHandler:s}}();$(document).on("ready",function(){GameSpace.initialize(),$(document).keypress(function(t){GameSpace.keyHandler(t.charCode)})});