var GameSpace=function(){var t=function(t){return"#column-"+String(t[0])+"-row-"+String(t[1])},o=function(t){$("#messages").append("<p>"+t+"</p>")},e=function(t,o){return f.map[m.y+o][m.x+t].impassable?"impassable":f.map[m.y+o][m.x+t].monster?"monster":void 0},s=function(t){if(108===t){var s=1,a=0;"impassable"===e(s,a)?o("You shall not pass!"):"monster"===e(s,a)||f.updateRogue(s,a)}else if(104===t){var s=-1,a=0;"impassable"===e(s,a)?o("You shall not pass!"):f.updateRogue(s,a)}else if(106===t){var s=0,a=1;"impassable"===e(s,a)?o("You shall not pass!"):f.updateRogue(s,a)}else if(107===t){var s=0,a=-1;"impassable"===e(s,a)?o("You shall not pass!"):f.updateRogue(s,a)}else if(117===t){var s=1,a=-1;"impassable"===e(s,a)?o("You shall not pass!"):f.updateRogue(s,a)}else if(121===t){var s=-1,a=-1;"impassable"===e(s,a)?o("You shall not pass!"):f.updateRogue(s,a)}else if(110===t){var s=1,a=1;"impassable"===e(s,a)?o("You shall not pass!"):f.updateRogue(s,a)}else if(98===t){var s=-1,a=1;"impassable"===e(s,a)?o("You shall not pass!"):f.updateRogue(s,a)}},a=function(o,e){this.rows=e,this.columns=o,this.map=[],this.tileMatrixGenerator=function(){for(var t=0;t<this.rows;t++){for(var o=[],e=0;e<this.columns;e++)o.push(new i([e,t]));this.map.push(o)}},this.createMap=function(){this.tileMatrixGenerator()},this.createRoom=function(t){for(var o=t.xCenter-Math.floor(t.width/2),e=t.yCenter-Math.floor(t.height/2),s=0;s<t.height;s++)for(var a=0;a<t.width;a++)0===s||s===t.height-1?this.map[s+e][a+o]=new h(a+o,s+e):(0===a||a===t.width-1)&&(this.map[s+e][a+o]=new h(a+o,s+e))},this.roomOverlapCheck=function(t,o){for(var e=t.upLeftCornerY;e<t.upLeftCornerY+t.height;e++)for(var s=t.upLeftCornerX;s<t.upLeftCornerX+t.width;s++)if("wall"===o[e][s].class)return!1;return!0},this.checkDoorPath=function(t,o,e){return"dot"===e[o][t-1].class&&"dot"===e[o][t+1].class?(console.log("leftright"),!0):"dot"===e[o-1][t].class&&"dot"===e[o+1][t].class?(console.log("updown"),!0):!1},this.doorsUpdateIfPossible=function(t,o){for(var e=0,s=0;s<t.length;s++){var a=t[s].xCenter-Math.floor(t[s].width/2),r=t[s].yCenter-Math.floor(t[s].height/2);t:for(var i=0;i<t[s].height;i++)for(var n=0;n<t[s].width;n++)if(0===i||i===t[s].height-1){if(this.checkDoorPath(n+a,i+r,o)){o[i+r][n+a]=new l(n+a,i+r),e++;break t}}else if((0===n||n===t[s].width-1)&&this.checkDoorPath(n+a,i+r,o)){o[i+r][n+a]=new l(n+a,i+r),e++;break t}}return console.log(e),e===t.length?!0:!1},this.randomRooms=function(t){var o=0,e=4,s=10,a=this.map;for(roomList=[];t>o;){var i=Math.floor(Math.random()*(this.columns-1.5*s)+s),n=Math.floor(Math.random()*(this.rows-1.5*s)+s),h=Math.floor(Math.random()*(s-e)+e),l=Math.floor(Math.random()*(s-e)+e),c=new r(i,n,h,l);this.roomOverlapCheck(c,a)&&(roomList.push(c),this.createRoom(c,a),o++)}if(console.log(roomList),console.log(),console.log(),console.log(),console.log(),!this.doorsUpdateIfPossible(roomList,a))return this.randomRooms;for(var p=0;p<roomList.length;p++)this.createRoom(p);this.doorsUpdateIfPossible(roomList,this.map)},this.createTerrain=function(){var t=new r(Math.floor(f.columns/2),Math.floor(f.rows/2),f.columns,f.rows);this.createRoom(t),this.randomRooms(Math.ceil(this.columns/2))},this.createMonsters=function(t){for(var o=0;t>o;){var e=Math.floor(Math.random()*f.rows),s=Math.floor(Math.random()*f.columns),a=new u(s,e);"dot"===f.map[e][s].class&&(f.map[e][s]=a,o++)}},this.placeCharacter=function(){this.map[m.y][m.x]=m},this.updateDisplay=function(o,e){$(t(o.location())).text(o.text),$(t(e.location())).text(e.text),$(t(o.location())).removeClass(),$(t(e.location())).removeClass(),$(t(e.location())).addClass(e.class+" tile"),$(t(o.location())).addClass(o.class+" tile")},this.updateRogue=function(t,o){var e=new i(m.x,m.y);console.log(e.location()),m.x+=t,m.y+=o,this.map[m.y][m.x]=m,this.map[m.y-o][m.x-t]=e,console.log(m.location()),this.updateDisplay(m,e)},this.drawMap=function(){$("#game-window").empty();var t=$("#game-window-template").html(),o=Handlebars.compile(t),e=this,s=0;Handlebars.registerHelper("columnCounter",function(){return s%e.columns}),Handlebars.registerHelper("rowCounter",function(){return s++,Math.floor(s/e.columns)}),$("#game-window").append(o(e))}},r=function(t,o,e,s){this.xCenter=t,this.yCenter=o,this.width=e,this.height=s,this.upLeftCornerX=this.xCenter-Math.floor(this.width/2),this.upLeftCornerY=this.yCenter-Math.floor(this.height/2)},i=function(t,o){this.x=t,this.y=o,this.text=".",this.class="dot",this.impassable=!1};i.prototype.location=function(){return[this.x,this.y]};var n=function(){};n.prototype=new i,n.prototype.constructor=n;var h=function(t,o){i.call(this,t,o),this.text="#",this.class="wall",this.impassable=!0};h.prototype=new n,h.prototype.constructor=h;var l=function(t,o){i.call(this,t,o),this.text="+",this.class="door",this.door=!0};l.prototype=new n,l.prototype.constructor=l;var c=function(t,o){i.call(this,t,o),this.text="@",this.class="character",this.health=100,this.attack=100,this.defense=100,this.damage=100};c.prototype=new i,c.prototype.constructor=c;var p=function(){this.healthBase=100,this.attackBase=100,this.damageBase=100,this.defenseBase=100,this.monster=!0};p.prototype.attack=function(){},p.prototype=new i,p.prototype.constructor=p;var u=function(t,o){i.call(this,t,o),this.class="rat",this.text="r",this.health=this.healthBase/10,this.attack=this.attackBase/10,this.defense=this.defenseBase/10,this.damage=this.damageBase/10,this.treasureQuality=1};u.prototype=new p,u.prototype.constructor=u;var f=new a(60,40),m=new c(Math.floor(f.columns/2),Math.floor(f.rows/2)),d=function(){f.createMap(),f.createTerrain(),f.placeCharacter(),f.createMonsters(10),f.drawMap()};return{initialize:d,rogue:m,currentLevel:f,keyHandler:s}}();$(document).on("ready",function(){GameSpace.initialize(),$(document).keypress(function(t){GameSpace.keyHandler(t.charCode)})});