var GameSpace=function(){var t=function(t){return"#column-"+String(t[0])+"-row-"+String(t[1])},o=function(t){$("#messages").append("<p>"+t+"</p>")},e=function(t,o){return f.map[d.y+o][d.x+t].impassable?"impassable":f.map[d.y+o][d.x+t].monster?"monster":void 0},a=function(t){if(108===t){var a=1,s=0;"impassable"===e(a,s)?o("You shall not pass!"):f.updateRogue(a,s)}else if(104===t){var a=-1,s=0;"impassable"===e(a,s)?o("You shall not pass!"):f.updateRogue(a,s)}else if(106===t){var a=0,s=1;"impassable"===e(a,s)?o("You shall not pass!"):f.updateRogue(a,s)}else if(107===t){var a=0,s=-1;"impassable"===e(a,s)?o("You shall not pass!"):f.updateRogue(a,s)}else if(117===t){var a=1,s=-1;"impassable"===e(a,s)?o("You shall not pass!"):f.updateRogue(a,s)}else if(121===t){var a=-1,s=-1;"impassable"===e(a,s)?o("You shall not pass!"):f.updateRogue(a,s)}else if(110===t){var a=1,s=1;"impassable"===e(a,s)?o("You shall not pass!"):f.updateRogue(a,s)}else if(98===t){var a=-1,s=1;"impassable"===e(a,s)?o("You shall not pass!"):f.updateRogue(a,s)}},s=function(o,e){this.rows=e,this.columns=o,this.map=[],this.tileMatrixGenerator=function(){for(var t=0;t<this.rows;t++){for(var o=[],e=0;e<this.columns;e++)o.push(new i(e,t));this.map.push(o)}},this.createMap=function(){this.tileMatrixGenerator()},this.createRoom=function(t,o){for(var e=t.xCenter-Math.floor(t.width/2),a=t.yCenter-Math.floor(t.height/2),s=0;s<t.height;s++)for(var r=0;r<t.width;r++)0===s||s===t.height-1?o[s+a][r+e]=new h(r+e,s+a):(0===r||r===t.width-1)&&(o[s+a][r+e]=new h(r+e,s+a))},this.roomOverlapCheck=function(t,o){for(var e=t.upLeftCornerY;e<t.upLeftCornerY+t.height;e++)for(var a=t.upLeftCornerX;a<t.upLeftCornerX+t.width;a++)if("wall"===o[e][a].class)return!1;return!0},this.checkDoorPath=function(t,o,e){return"dot"===e[o][t-1].class&&"dot"===e[o][t+1].class?!0:"dot"===e[o-1][t].class&&"dot"===e[o+1][t].class?!0:!1},this.doorsUpdateIfPossible=function(t,o){for(var e=0,a=0;a<t.length;a++){var s=t[a].xCenter-Math.floor(t[a].width/2),r=t[a].yCenter-Math.floor(t[a].height/2);t:for(var i=0;i<t[a].height;i++)for(var n=0;n<t[a].width;n++)if(0===i||i===t[a].height-1){if(this.checkDoorPath(n+s,i+r,o)){o[i+r][n+s]=new l(n+s,i+r),t[a].doorLocationX=n+s,t[a].doorLocationY=i+r,e++;break t}}else if((0===n||n===t[a].width-1)&&this.checkDoorPath(n+s,i+r,o)){o[i+r][n+s]=new l(n+s,i+r),t[a].doorLocationX=n+s,t[a].doorLocationY=i+r,e++;break t}}return e===t.length?!0:!1},this.cloneMap=function(){for(var t=[],o=0;o<this.map.length;o++)t.push(this.map[o].clone());return t},this.roomList,this.popRoom=function(o,e){console.log(e.upLeftCornerY);for(var a=e.upLeftCornerY+1;a<e.height+e.upLeftCornerY-1;a++)for(var s=e.upLeftCornerX+1;s<e.width+e.upLeftCornerX-1;s++)o?(console.log(t([s,a])),$(t([s,a])).removeClass("hidden")):(console.log("something"),$(t([s,a])).addClass("hidden"))},this.darkenRooms=function(t){for(var o=0;o<t.length;o++)this.popRoom(!1,t[o])},this.randomRooms=function(t){for(var o=4,e=11,a=this.cloneMap(),s=[],i=0;t>i;){var n=Math.floor(Math.random()*(this.columns-e)+e/2),h=Math.floor(Math.random()*(this.rows-e)+e/2),l=Math.floor(Math.random()*(e-o)+o),c=Math.floor(Math.random()*(e-o)+o),p=new r(n,h,l,c);this.roomOverlapCheck(p,a)&&(s.push(p),this.createRoom(p,a),i++)}if(!this.doorsUpdateIfPossible(s,a))return this.randomRooms(t);for(var u=0;u<s.length;u++)this.createRoom(s[u],this.map);this.doorsUpdateIfPossible(s,this.map),this.roomList=s.clone()},this.createTerrain=function(){var t=new r(Math.floor(f.columns/2),Math.floor(f.rows/2),f.columns,f.rows);this.createRoom(t,this.map),this.randomRooms(Math.ceil(Math.sqrt(this.columns*this.rows)/1.5))},this.createMonsters=function(t){for(var o=0;t>o;){var e=Math.floor(Math.random()*f.rows),a=Math.floor(Math.random()*f.columns),s=new u(a,e);"dot"===f.map[e][a].class&&(f.map[e][a]=s,o++)}},this.placeCharacter=function(){this.map[d.y][d.x]=d},this.updateDisplay=function(o,e){$(t(o.location())).text(o.text),$(t(e.location())).text(e.text),$(t(o.location())).removeClass(),$(t(e.location())).removeClass(),$(t(e.location())).addClass(e.class+" tile"),$(t(o.location())).addClass(o.class+" tile")},this.updateRogue=function(t,o){var e=new i(d.x,d.y);console.log(e.location()),d.x+=t,d.y+=o,this.map[d.y][d.x]=d,this.map[d.y-o][d.x-t]=e,console.log(d.location()),this.updateDisplay(d,e)},this.drawMap=function(){$("#game-window").empty();var t=$("#game-window-template").html(),o=Handlebars.compile(t),e=this,a=0;Handlebars.registerHelper("columnCounter",function(){return a%e.columns}),Handlebars.registerHelper("rowCounter",function(){return a++,Math.floor(a/e.columns)}),$("#game-window").append(o(e))}},r=function(t,o,e,a,s,r){this.xCenter=t,this.yCenter=o,this.width=e,this.height=a,this.doorLocationX=s||null,this.doorLocationY=r||null,this.upLeftCornerX=this.xCenter-Math.floor(this.width/2),this.upLeftCornerY=this.yCenter-Math.floor(this.height/2)},i=function(t,o){this.x=t,this.y=o,this.text=".",this.class="dot",this.impassable=!1};i.prototype.location=function(){return[this.x,this.y]};var n=function(){};n.prototype=new i,n.prototype.constructor=n;var h=function(t,o){i.call(this,t,o),this.text="#",this.class="wall",this.impassable=!0};h.prototype=new n,h.prototype.constructor=h;var l=function(t,o){i.call(this,t,o),this.text="+",this.class="door",this.door=!0};l.prototype=new n,l.prototype.constructor=l;var c=function(t,o){i.call(this,t,o),this.text="@",this.class="character",this.health=100,this.attack=100,this.defense=100,this.damage=100};c.prototype=new i,c.prototype.constructor=c;var p=function(){this.healthBase=100,this.attackBase=100,this.damageBase=100,this.defenseBase=100,this.monster=!0};p.prototype.attack=function(){},p.prototype=new i,p.prototype.constructor=p;var u=function(t,o){i.call(this,t,o),this.class="rat",this.text="r",this.health=this.healthBase/10,this.attack=this.attackBase/10,this.defense=this.defenseBase/10,this.damage=this.damageBase/10,this.treasureQuality=1};u.prototype=new p,u.prototype.constructor=u;var f=new s(60,40),d=new c(1,1),m=function(){f.createMap(),f.createTerrain(),f.placeCharacter(),f.createMonsters(30),f.drawMap(),f.darkenRooms(f.roomList)};return{initialize:m,rogue:d,currentLevel:f,keyHandler:a}}();Object.prototype.clone=function(){var t=this instanceof Array?[]:{};for(i in this)"clone"!=i&&(t[i]=this[i]&&"object"==typeof this[i]?this[i].clone():this[i]);return t},$(document).on("ready",function(){GameSpace.initialize(),$(document).keypress(function(t){GameSpace.keyHandler(t.charCode)})});